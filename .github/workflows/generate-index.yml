name: Generate Folder Index

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate index file
        run: |
          echo "# ðŸ“‚ Ãndice de Pastas" > INDEX.md
          echo "" >> INDEX.md

          # Percorre todas as pastas (ignorando .git e similares)
          find . -type d ! -path './.git*' | while read dir; do
            # Lista apenas arquivos "reais" dentro da pasta (exclui .gitkeep)
            files=$(find "$dir" -maxdepth 1 -type f ! -name ".gitkeep")

            # Se houver arquivos, adiciona a pasta e os arquivos ao Ã­ndice
            if [ -n "$files" ]; then
              dirname=$(echo "$dir" | sed 's|^\./||')
              echo "## ${dirname}" >> INDEX.md

              # Lista os arquivos com links clicÃ¡veis
              for f in $files; do
                fname=$(basename "$f")
                echo "- [${fname}](${f})" >> INDEX.md
              done

              echo "" >> INDEX.md
            fi
          done

      - name: Commit and push updated index
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add INDEX.md
          git commit -m "ðŸ”„ Atualizar Ã­ndice automÃ¡tico" || echo "Nenhuma alteraÃ§Ã£o"
          git push